# LETE Results {#Results}
```{r tidyr3, echo = FALSE, message = FALSE, warning = FALSE}

library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=50), tidy = TRUE)
# need to register google key:
#register_google(key = "INSERT KEY HERE")

```

```{r loadPackages2, eval = TRUE, echo = FALSE, message = FALSE, warning = FALSE}
## Importing data if not already loaded
library(ggmap)
library(tidyr)
library(gridExtra)
library(ggplot2)
library(viridis)
library(motus)
library(pander)
```

## Study Area
Stations within the study region are presented below, grey stations had no detections, while red stations had at least one tag detected during the study period from 2017 to 2018. Triangles represent receivers that were active during 2017 *and* 2018, circles represent stations that were only active in 2017 (Quintana and East Grand Terre). The blue lines indicate the direction of antennas during the study period. All receivers maintained the same bearings throughout the study period with the exception of Bolivar_Flats, here the solid blue lines are the 2017 bearings, while the dashed blue lines are the 2018 bearings.

********ADD SCALE BARS TO ALL MAPS*******

```{r 2017StationMap, echo = FALSE, message = FALSE, warning = FALSE}
na.map <- map_data(map = "world2")
na.map <- na.map %>%  mutate(long = long - 360)
arr.sc <- 0.5  # determines length of the vectors for antenna bearings and vanishing bearing lines
na.map <- map_data(map = "world2")
na.map <- na.map %>% filter(region %in% c("Canada",
                                          "USA")) %>% mutate(long = long - 360)
arr.sc <- 0.5  # determines length of the vectors for antenna bearings and vanishing bearing lines
ggplot(na.map, aes(long, lat)) +
  geom_polygon(data = na.map, aes(long, lat, group = group), colour = "grey", fill = "blue") +
  geom_polygon(aes(group = group), colour = "grey", fill = "grey98") +
  coord_map(projection = "mercator", xlim = c(-98, -88), ylim = c(27, 31)) +
  xlab("") + ylab("") + theme_bw() +
  geom_segment(data = filter(df.antDeps, !(recvDeployID %in% c(5149, 4304, 4615, 4616))), # remove Quintana and Bolivar deployments outside detection range
               aes(x = longitude, xend = longitude +
                     (sin(rad(antBearing)) *arr.sc), y = latitude, yend = latitude +
                     (cos(rad(antBearing)) *arr.sc)), colour = "blue") +
  geom_segment(data = filter(df.antDeps, recvDeployID == 4616), # Create dashed lines for Bolicvar 2018 antenna bearings
               aes(x = longitude, xend = longitude +
                     (sin(rad(antBearing)) *arr.sc), y = latitude, yend = latitude +
                     (cos(rad(antBearing)) *arr.sc)), colour = "blue", linetype = "dashed") +
  geom_point(data = df.recvDepsCombined,
             aes(longitude, latitude, shape = active, fill = incubate), colour = "black", size = 4) +
  scale_shape_manual(values = c(21, 24)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("Quintana", "Bolivar_Flats", "Wisner")),
            aes(longitude, latitude, label=recvDeployName, hjust = -0.2, vjust = 1)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("East Grand Terre")),
            aes(longitude, latitude, label=recvDeployName, hjust = -0.1, vjust = 0.1)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("Scenic Galveston", "San Bernard NWR (Big Pond Unit)")),
          aes(longitude, latitude, label=recvDeployName, hjust = 1.1, vjust = 0.5)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("San Bernard National Wildlife Refuge Headquarters")),
            aes(longitude, latitude, label="San Bernard NWR Headquarters", hjust = 1, vjust = 0.5)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("Grand_Isle")),
            aes(longitude, latitude, label=recvDeployName, hjust = 1.2, vjust = 0.5)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("Exxon Fields")),
            aes(longitude, latitude, label=recvDeployName, hjust = 1, vjust = -1)) +
  theme(legend.position = "none")

ggsave("./images/outlineMap.png")
```  
All LETE were tagged within close proximity to Exxon Fields, and for the purposes of this report stations considered within proximity to the breeding area are Exxon Fields, East Grand Terre, Grand_Isle, and Wisner. A close up of this area is below:

```{r breedingRegionMap, echo = FALSE, message = FALSE, warning = FALSE}
arr.sc <- 0.3  # determines length of the vectors for antenna bearings and vanishing bearing lines
ggplot(na.map, aes(long, lat)) +
  geom_polygon(data = na.map, aes(long, lat, group = group), colour = "grey", fill = "blue") +
  geom_polygon(aes(group = group), colour = "grey", fill = "grey98") +
  coord_map(projection = "mercator", xlim = c(-91, -88.5), ylim = c(28.4, 30)) +
  xlab("") + ylab("") + theme_bw() +
  geom_segment(data = filter(df.antDeps, !(recvDeployID %in% c(5149, 4304, 4615, 4616))), # remove Quintana and Bolivar deployments outside detection range
               aes(x = longitude, xend = longitude +
                     (sin(rad(antBearing)) *arr.sc), y = latitude, yend = latitude +
                     (cos(rad(antBearing)) *arr.sc)), colour = "blue") +
  geom_segment(data = filter(df.antDeps, recvDeployID == 4616), # Create dashed lines for Bolicvar 2018 antenna bearings
               aes(x = longitude, xend = longitude +
                     (sin(rad(antBearing)) *arr.sc), y = latitude, yend = latitude +
                     (cos(rad(antBearing)) *arr.sc)), colour = "blue", linetype = "dashed") +
  geom_point(data = df.recvDepsCombined,
             aes(longitude, latitude, shape = active, fill = incubate), colour = "black", size = 4) +
  scale_shape_manual(values = c(21, 24)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("Quintana", "Bolivar_Flats", "Wisner")),
            aes(longitude, latitude, label=recvDeployName, hjust = -0.2, vjust = 1)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("East Grand Terre")),
            aes(longitude, latitude, label=recvDeployName, hjust = -0.1, vjust = 0.1)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("Scenic Galveston", "San Bernard NWR (Big Pond Unit)")),
            aes(longitude, latitude, label=recvDeployName, hjust = 1.1, vjust = 0.5)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("San Bernard National Wildlife Refuge Headquarters")),
            aes(longitude, latitude, label="San Bernard NWR Headquarters", hjust = 1, vjust = 0.5)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("Grand_Isle")),
            aes(longitude, latitude, label=recvDeployName, hjust = 1.2, vjust = 0.5)) +
  geom_text(data = filter(df.recvDepsCombined, recvDeployName %in% c("Exxon Fields")),
            aes(longitude, latitude, label=recvDeployName, hjust = 1, vjust = -1)) +
  theme(legend.position = "none")
ggsave("./images/closeUpMap.png")
```

## Detection Overview
In 2017, only 1 individual (motusTagID 23270) was detected at stations outside the immediate tagging region, all other individuals and the bulk of the detections occurred at Exxon Fields, East Grand Terre, Grand_Isle, and Wisner. The map below shows the detection pattern of all 2017 tagged birds, lines are coloured by tag ID.
```{r 2017DetectionMap, echo = FALSE, message = FALSE, warning = FALSE}
# outline map of 2017 incubation detections
ggplot(na.map, aes(long, lat)) +
  geom_polygon(data = na.map, aes(long, lat, group = group), colour = "grey", fill = "blue") +
  geom_polygon(aes(group = group), colour = "grey", fill = "grey98") +
  coord_map(projection = "mercator", xlim = c(-98, -88), ylim = c(27, 31)) +
  geom_point(data = df.recvDepsCombined,
             aes(longitude, latitude, fill = incubate), shape = 21, colour = "black", size = 4) +
  geom_path(data = filter(lete.path, year == "2017"),
            aes(recvLon, recvLat, group = motusTagID, col = as.factor(motusTagID)),
            position = position_jitter(w=0, h = 0.05)) +
  labs(x = NULL, y = NULL, col = "Motus Tag ID") + theme_bw() + guides(fill = FALSE)
ggsave("./images/detections2017.png")
```

The plot below is the same 2017 data as mapped above, each plot is one individual's detections during incubation plotted as time by longitude, points are coloured by detection site. Note that x and y scales vary between plots.
```{r colourBlindPalette, echo = FALSE, message = FALSE, warning = FALSE, results = "hide"}
## Create a colour blind friendly palette for stations
# Get all station names
unique(lete.path$recvDeployName)
cols <- c("Exxon Fields" = "#0072B2", "Grand_Isle" = "#E69F00", "Wisner" = "#D55E00",
          "East Grand Terre" = "#009E73", "Quintana" = "#000000",
          "San Bernard National Wildlife Refuge Headquarters" = "#CC79A7",
          "San Bernard NWR (Big Pond Unit)" = "#F0E442", "Scenic Galveston" = "#999999",
          "Bolivar_Flats" = "#56B4E9")

```
```{r 2017LongitudePlots, echo = FALSE, message = FALSE, fig.height = 10}
ggplot(filter(lete.path, year == "2017"),
       aes(ts.h, recvLon, group = as.factor(motusTagID))) +
  geom_point(aes(colour = as.factor(recvDeployName)), size = 1) +
  geom_path(col = "grey45") +
  th + labs(y = "what") + facet_wrap(~motusTagID, scales = "free", ncol = 4) +
  theme(legend.direction = "horizontal",
        legend.position = c(0.6, 0),
        legend.title = element_blank(),
        axis.title = element_blank()) +
  scale_color_manual(values = cols) +
  theme(text = element_text(size = 8))
ggsave("./images/2017LongitudePlot.png")
```

In 2018, again only one individual was detected outside the immediate tagging region, all other individuals and the bulk of the detections occurred at Exxon Fields, East Grand Terre, Grand_Isle. Note that in 2018 no birds were detected at Wisner, despite close proximity to nesting areas. Based on receiver performance outputs, this is likely due to receiver issues rather than a true lack of detections. The map below shows the detection pattern of all 2018 tagged birds, lines are coloured by tag ID.
```{r 2018DetectionMap, message = FALSE, echo = FALSE, warning = FALSE}
## Map of 2018 detections
ggplot(na.map, aes(long, lat)) +
  geom_polygon(data = na.map, aes(long, lat, group = group), colour = "grey", fill = "blue") +
  geom_polygon(aes(group = group), colour = "grey", fill = "grey98") +
  coord_map(projection = "mercator", xlim = c(-98, -88), ylim = c(27, 31)) +
  geom_point(data = df.recvDepsCombined,
             aes(longitude, latitude, fill = incubate), shape = 21, colour = "black", size = 4) +
  geom_path(data = filter(lete.path, year == "2018"),
            aes(recvLon, recvLat, group = motusTagID, col = as.factor(motusTagID)),
            position = position_jitter(w=0, h = 0.05)) +
  labs(x = NULL, y = NULL, col = "Motus Tag ID") + theme_bw() + guides(fill = FALSE)
```

The plot below is the same 2018 data as mapped above, each plot is one individual's detections during incubation plotted as time by longitude, points are coloured by detection site. Note that x and y scales vary between plots.
```{r 2018LongitudePlots, echo = FALSE, message = FALSE, fig.height = 10}
ggplot(filter(lete.path, year == "2018"),
       aes(ts.h, recvLon, group = as.factor(motusTagID))) +
  geom_point(aes(colour = as.factor(recvDeployName)), size = 1) +
  geom_path(col = "grey45") +
  th + labs(y = "what") + facet_wrap(~motusTagID, scales = "free", ncol = 4) +
  theme(legend.direction = "horizontal",
        legend.position = "bottom",
        legend.title = element_blank(),
        axis.title = element_blank()) +
  scale_color_manual(values = cols) +
    theme(text = element_text(size = 8))
ggsave("./images/2018LongitudePlot.png")
```

## Foraging vs Incubating
```{r incubatingBirds, echo = FALSE, message = FALSE}
p1 <- ggplot(filter(inc, motusTagID == 23219), aes(ts, sig, col = recvDeployName)) + geom_point(size = 0.5) +
  facet_grid(recvDeployName~.) +
  geom_vline(xintercept = inc$sunrise,col = "orange") +
  geom_vline(xintercept = inc$sunset, col = "blue") + th +
  theme(legend.position = "none") + labs (y = "Signal Strength", x = NULL, title ="2017: motusTagID 23219")
p2 <- ggplot(filter(inc, motusTagID == 23218, ts > as.POSIXct("2017-06-15")), aes(ts, sig, col = recvDeployName)) + geom_point(size = 0.5) +
  facet_grid(recvDeployName~.) +
  geom_vline(xintercept = inc$sunrise,col = "orange") +
  geom_vline(xintercept = inc$sunset, col = "blue") + th +
  theme(legend.position = "none") + labs (y = "Signal Strength", x = NULL, title ="2017: motusTagID 23218")
p3 <- ggplot(filter(inc, motusTagID == 28593), aes(ts, sig, col = recvDeployName)) + geom_point(size = 0.5) +
  facet_grid(recvDeployName~.) +
  geom_vline(xintercept = inc$sunrise,col = "orange") +
  geom_vline(xintercept = inc$sunset, col = "blue") + th +
theme(legend.position = "none") + labs (y = "Signal Strength", x = NULL, title ="2018: motusTagID 28593")
p4 <- ggplot(filter(inc, motusTagID == 28522), aes(ts, sig, col = recvDeployName)) + geom_point(size = 0.5) +
  facet_grid(recvDeployName~.) +
  geom_vline(xintercept = inc$sunrise,col = "orange") +
  geom_vline(xintercept = inc$sunset, col = "blue") + th +
  theme(legend.position = "none") + labs (y = "Signal Strength", x = NULL, title ="2018: motusTagID 28522")
grid.arrange(p1, p2, p3, p4, nrow = 2)

```

The above plot is a selection of 4 representative detection patterns of individuals; examining the signal strength it is not always clear when birds are attending the nest site and when they are foraging. For example, tag 23219 shows clear daily signal strength patterns, with low signal strength occuring overnight when the bird is likely incubating. Tag 23218 has a similar but less distinct pattern, some nights the bird is detected while other nights it is not. In other cases the tag is picked up far less consistently as in tag 28593, and in even more extreme cases as in tag 28522. For these final two tags, the bird is rarely if ever detected while at the nest site, and most detections likely occur as the bird is leaving or arriving at the nest site. 

Furthermore, even tags with clear daily detection patterns as in tag 23219, shorter nest site attendance periods during the day are not as obviously picked up. However, based on these detections, the signal strength during incubation is generally much lower than during flight. This is to be expected as a tags detection range increases substantially when a bird is in the air as compared to on the ground. Therefore, all detections on the Exxon Fields receiver with a signal strength < 80 will be excluded from foraging analysis from this point onwards to exclude likely detections on the nest. While this will invariably also remove detections on Exxon Fields that may occur when the bird is in flight, since the station is in very close proximity to the nesting site, in most cases this will only remove the tail ends of a detection streak as the bird is departing or approaching the nesting site. 

```{r removeIncubationDetections, echo = FALSE, message = FALSE}
foraging <- filter(inc, !(recvDeployName == "Exxon Fields" & sig <80))
```

## Heavily Frequented Foraging Areas
Detections were split into discrete site visits, a site visit was categorized as a set of consecutive detections of a single tag at a single station. To account for short periods of no detections within an otherwise continuous site visit, discrete site visits that were <10 minutes apart were lumped together to form a single site visit. 

To add meaning to detection sites, the distance from Exxon Fields was calculated for each station where tags were detected and are presented below. A full database with distances calculated between all stations can be found in Appendix \@ref(AppendixA).

```{r distanceTable, echo = FALSE, message = FALSE}
p <- dist %>% filter(recvDeployName1 == "Exxon Fields") %>% 
  select(recvDeployName2, distance) %>%
  arrange(distance)
p <- rename(p, "Site Name" = "recvDeployName2", "Distance from Exxon Fields (m)" = "distance")
pander(p, split.cell = 50, split.table = Inf, justify = c("left"))
```

For each station the number of total number of visits was calculated, as expected Exxon Fields had by far the highest number of visits as it was at the nesting area. In 2017 and 2018 Grand_Isle had the next highest frequency of detections, this is not surprising as it is the closest station to the nesting area. East Grand Terre and Wisner followed with lower numbers of site visits and are also near the nesting area. Note the lack of detections at Wisner in 2018, this is likely due to receiver malfunction rather than a true lack of detections. All other stations had negligible (<3) visits and are substantially farther away from the nesting grounds.
```{r visitFrequency, echo = FALSE, message = FALSE}
ggplot(filter(visits), aes(recvDeployName)) +
  geom_bar(stat = "count") + geom_text(stat= "count", aes(label = ..count..), vjust = -1, size = 3) +
  facet_grid(year~.) + th + ylim(0,2300) +
  labs(y = "Number of site visits", x = NULL,
       title = "Detection Frequencies of tags at each station by year, \n ordered by distance from Exxon Fields")
```

The length of visits was consistant with the number of visits, that is, birds generally had longer detection periods at Exxon Fields, followed by East Grand Terre, Grand_Isle, and Wisner, only Grand_Isle and Exxon Fields differed significantly in their visit length. The figure below shows the length of time each bird was detected at each site during each site visit, note that the plot has been cut off due to a high number of outliers, Exxon Fields had a maximum visit length of 61 minutes, Grand_Isle 107 minutes, East Grand Terre 19 minutes, Wisner 27 minutes (See Appendix \@ref(AppendixB) for complete visit information).
```{r visitLength, echo = FALSE, message = FALSE}
tmp <- aov(data = filter(visits, recvDeployName %in% c("East Grand Terre", "Exxon Fields", "Grand_Isle", "Wisner")), visitLength ~ recvDeployName)
#summary(tmp)
tukey <- TukeyHSD(tmp, conf.level=0.95)
#plot(TukeyHSD(tmp, conf.level = 0.95), las=1, col = "red")

p <- ggplot(visits, aes(recvDeployName, visitLength)) +
  geom_boxplot() + facet_grid(year~.)
ylim1 <- boxplot.stats(visits$visitLength)$stats[c(1,5)]
p + coord_cartesian(ylim = ylim1*1.05) + th + 
  labs(title = "Length of visits (mins) to each station during foraging for 2017 and 2018, \n ordered by distance from Exxon Fields", 
       y = "Detection time (mins)", 
       x = NULL)
```

Of the birds that were detected at Exxon Fields in 2017 and 2018, all were detected on at least 6 different visits. At Grand_Isle, the majority (39/44, 88.6%) of birds were detected on more than 2 separate occasions (>2 discrete visits). In comparison, at the remaining stations less than half (10/23, 43.5%) were detected on more than two occasions. Only tags 23261 appeared semi-regularly at wisner but is notable in 12 detections. 

Thus birds appear to spend the majority of their time in close proximity to Exxon Fields, however this could be a by-product of increased detection due to proximity to nesting sites and therefore a necessity to frequently pass the receiver regardless if foraging is occuring nearby or not. Most birds frequented Grand_Isle regularly which could be due to nearby foraging, or a proximity to the nesting site. See Appendix \@ref(AppendixC) for detection plots of all birds detected more than twice on stations outside of Exxon Fields and Grand_Isle. 

*******NEED TO ADD THIS APPENDIX*******

### Simultaneous Detections
```{r simSites, echo = FALSE, message = FALSE}
# how often are birds detected simultaneously at 2 or more stations?
simSites <- simSiteDet(foraging)
# in 2017 the vast majority are simultaneous detections between Exxon Fields and Grand_Isle,
# with 3 instance between East Grand Terre and Grand_isle,
# 1 instance between East Grand Terre and Exxon Fields,

# in 2018 there was only 1 instance between East Grand Terre and Exxon Fields,
```
If stations are within close proximity of one another, it's possible to get simultaneous detections on both stations at once. During incubation there were 161 pairs of simultaneous detections, 2 of these occurred between East Grand Terre and Exxon Fields, 3 between East Grand Terre and Grand Isle, and the other 156 between Exxon Fields and Grand Isle. Exxon Fields and Grand Isle are the closest two stations at 3.1 km apart, easily within range of each other particularly when birds are in flight (see Appendix \@ref(AppendixA)). East Grand Terre is 12.6 km and 15.8 km away from Exxon Fields and Grand Isle respectively, the next closest pairs of stations.

### Detection Directions
We can narrow down the areas visited beyond which site they were detected at by examining which antenna they were detected on. The figures below show the total number of detections for each antenna bearing at each site for 2017 and 2018. Orange lines are the antenna bearings at each site, the blue bars are coloured by the number of detections on each antenna throughout the incubation period - note that scales differ by site.
```{r detBearingsSum, echo = FALSE, message = FALSE, warning = FALSE, fig.height = 8}
# get summary of foraging antenna bearings
for.dir <- foraging %>% group_by(year, recvDeployName, antBearing, recvLat, recvLon, recvDeployID) %>%
  summarize(nDet = length(antBearing)) %>% as.data.frame()
for.dir$siteYear <- paste(for.dir$recvDeployName, for.dir$year, sep = "")
# make a theme for the circular plots
thCirc <- theme_bw() + theme(axis.title.y = element_blank(),
                             legend.position = "none",
                             plot.title = element_text(hjust = 0.5),
                             axis.ticks.y = element_blank(),
                             text = element_text(size = 8))

# make scales for all plots
sf <- scale_fill_gradient(low = "#3399FF", high = "#000033", limits = c(1, 7200))
cp <- coord_polar(theta = "x", start = 0)
sx <- scale_x_continuous("",limits = c(0,360), breaks = seq(0, 360-1, 45))
gb <- geom_bar(stat = "identity", width = 15)
# make plot to get full legend across all plots
legendPlot <- ggplot(for.dir, aes(antBearing, nDet, fill = nDet)) +
  sf + cp + sx + gb + labs(fill = "Number of Detections") +
  theme(legend.direction = "horizontal",
        legend.position = "bottom")
# get common legend across all plots
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}
mylegend<-g_legend(legendPlot)

# 2017
# East Grand Terre
grandTerre17 <- ggplot(filter(for.dir, year == 2017, recvDeployName == "East Grand Terre"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "East Grand Terre")$antBearing,col = "orange") +
  labs(title ="East Grand Terre") + sf + cp + sx + gb + thCirc
# Exxon Fields
exxon17 <- ggplot(filter(for.dir, year == 2017, recvDeployName == "Exxon Fields"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "Exxon Fields")$antBearing,col = "orange") +
  labs(title ="Exxon Fields") + sf + cp + sx + gb + thCirc
# Grand_Isle
grandIsle17 <- ggplot(filter(for.dir, year == 2017, recvDeployName == "Grand_Isle"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "Grand_Isle")$antBearing,col = "orange") +
  labs(title ="Grand Isle") + sf + cp + sx + gb + thCirc
# Quintana
quintana17 <- ggplot(filter(for.dir, year == 2017, recvDeployName == "Quintana"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployID == 2985)$antBearing,col = "orange") +
  labs(title ="Quintana") + sf + cp + sx + gb + thCirc
# San Bernard National Wildlife Refuge Headquarters
headquarters17 <- ggplot(filter(for.dir, year == 2017, recvDeployName == "San Bernard National Wildlife Refuge Headquarters"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "San Bernard National Wildlife Refuge Headquarters")$antBearing,col = "orange") +
  labs(title ="San Bernard NWR HQ") + sf + cp + sx + gb + thCirc
# San Bernard NWR (Big Pond Unit)
bigPond17 <- ggplot(filter(for.dir, year == 2017, recvDeployName == "San Bernard NWR (BPU)"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "San Bernard NWR (Big Pond Unit)")$antBearing,col = "orange") +
  labs(title ="San Bernard NWR (Big Pond Unit)") + sf + cp + sx + gb + thCirc
# Scenic Galveston
galveston17 <- ggplot(filter(for.dir, year == 2017, recvDeployName == "Scenic Galveston"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "Scenic Galveston")$antBearing,col = "orange") +
  labs(title ="Galveston") + sf + cp + sx + gb + thCirc
# Wisner
wisner17 <- ggplot(filter(for.dir, year == 2017, recvDeployName == "Wisner"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "Wisner")$antBearing,col = "orange") +
  labs(title ="Wisner") + sf + cp + sx + gb + thCirc
# all of 2017
grid.arrange(arrangeGrob(exxon17, grandIsle17, wisner17, grandTerre17,
             galveston17, bigPond17, quintana17, headquarters17,
             nrow = 4,
             layout_matrix = rbind(c(1, 1, 3, 4),
                                   c(1, 1, 3, 4),
                                   c(2, 2, 5, 6),
                                   c(2, 2, 7, 8))),
             mylegend, nrow = 2, heights = c(20,1),
             top = "2017: Number of detections by antenna bearing")
ggsave("./images/2017antennaDetections.png")

# 2018
# Bolivar_Flats
bolivar18 <- ggplot(filter(for.dir, year == 2018, recvDeployName == "Bolivar_Flats"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployID == 4615)$antBearing,col = "orange") +
  labs(title ="Bolivar Flats") + sf + cp + sx + gb + thCirc
# East Grand Terre
grandTerre18 <- ggplot(filter(for.dir, year == 2018, recvDeployName == "East Grand Terre"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "East Grand Terre")$antBearing,col = "orange") +
  labs(title ="East Grand Terre") + sf + cp + sx + gb + thCirc
# Exxon Fields
exxon18 <- ggplot(filter(for.dir, year == 2018, recvDeployName == "Exxon Fields"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "Exxon Fields")$antBearing,col = "orange") +
  labs(title ="Exxon Fields") + sf + cp + sx + gb + thCirc
# Grand_Isle
grandIsle18 <- ggplot(filter(for.dir, year == 2018, recvDeployName == "Grand_Isle"), aes(antBearing, nDet, fill = nDet)) +
  geom_vline(xintercept = filter(df.antDeps, recvDeployName == "Grand_Isle")$antBearing,col = "orange") +
  labs(title ="Grand Isle") + sf + cp + sx + gb + thCirc
# all of 2018
grid.arrange(arrangeGrob(exxon18, grandIsle18, grandTerre18, bolivar18,
             nrow = 2,
             layout_matrix = rbind(c(1, 2),
                                   c(3, 4))),
             mylegend, nrow = 2, heights = c(20,1),
             top = "2018: Number of detections by antenna bearing")
ggsave("./images/2018antennaDetections.png")

```

Detection patterns are similar at Exxon Fields, Grand Isle, and East Grand Terre in 2017 and 2018. Detections at Exxon Fields were predominantly to the SW, directly in line with the tagging area, this also indicates that birds likely arrive and depart to/from the nesting location from the SW. Grand Isle detections were overwhealmingly more prevalent to the NE, pointing towards the nearby colony, while this may indicate that birds don't spend much time foraging to the SW, it could also be due to the sheer proximity of the nesting site. As discussed earlier, nearly all cases of simultaneous detections between two stations occur between Exxon Fields and Grand Isle, suggesting that many of the arrival and departure flights from the colony could be captured by both stations, resulting in the high number of NE detections at Grand Isle being an artifact of colony attendance. East Grand Terre had the most detections by far to the SW, again towards the colony. 

In 2017, birds were picked up in very small numbers outside of the immediate breeding area. It is difficult to make generalized assumptions from such a small number of detections, however it does seem as though a few birds may be using the areas off the coast around Quintana. There are even fewer detections away from the colony during incubation in 2018, but those that do occur are in the same region. 

## Mean Distances Travelled for Foraging
```{r distanceTravelled, echo = FALSE, message = FALSE, results = "hide"}
summary(visits$distFromExxon)
# mean of 1670m, max of 569092m
summary(filter(visits, year == 2017)$distFromExxon) # mean 2528m, max 569092
summary(filter(visits, year == 2018)$distFromExxon) # mean 866.4m, max 464126.4m
table(visits$year, visits$recvDeployName)
# but in 2017 on 7 visits away from breeding area (Exxon, Grand Isle, E Grand Terre, Wisner), in 2018 only 1 visit away
# So 4,366/4,374 = 99.8% were within 23072m from Exxon (furthest being Wisner)
```
Based on detection data, in 2017 the mean distance travelled for all detection periods was 2.5km, with a maximum distance travelled to San Bernard NWR (Big Pond Unit) at 569.1 km. In 2018 the mean distance travelled was 0.86 km, with a maximum distance travelled of 464.1 km to Bolivar Flats. However, the vast majority of detections (4,366/4,374 or 99.8%) during foraging trips occurred within 23.1 km from the colony detected at the four closest receiver stations (Exxon Fields, Grand Isle, East Grand Terre, and Wisner).

## Time Partitioning Between Foraging and Nest Site Attendance




